<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Management - ThreadCraft Studio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://use.typekit.net/yjp3aho.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-50 font-['sofia-pro']">
  <!-- Simple Admin Header -->
  <header class="bg-white shadow-sm border-b" data-id="admin-header">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-2xl font-bold text-gray-800" data-id="admin-title">ThreadCraft Studio - Orders</h1>
          <p class="text-gray-600" data-id="admin-subtitle">Manage your string art orders</p>
        </div>
        <a href="index.html" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors" data-id="back-to-site">
          ‚Üê Back to Site
        </a>
      </div>
    </div>
  </header>

  <!-- Orders Dashboard -->
  <main class="max-w-7xl mx-auto px-4 py-8" data-id="admin-main">
    <!-- Stats Cards -->
    <div class="grid md:grid-cols-4 gap-6 mb-8" data-id="stats-grid">
      <div class="bg-white rounded-lg p-6 shadow-sm">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">Total Orders</p>
            <p class="text-2xl font-bold text-gray-800" data-id="total-orders">0</p>
          </div>
          <div class="bg-orange-100 p-3 rounded-full">
            <i data-lucide="shopping-cart" class="w-6 h-6 text-orange-600"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-lg p-6 shadow-sm">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">Pending</p>
            <p class="text-2xl font-bold text-amber-600" data-id="pending-orders">0</p>
          </div>
          <div class="bg-amber-100 p-3 rounded-full">
            <i data-lucide="clock" class="w-6 h-6 text-amber-600"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-lg p-6 shadow-sm">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">Revenue</p>
            <p class="text-2xl font-bold text-green-600" data-id="total-revenue">$0</p>
          </div>
          <div class="bg-green-100 p-3 rounded-full">
            <i data-lucide="dollar-sign" class="w-6 h-6 text-green-600"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-lg p-6 shadow-sm">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">Today</p>
            <p class="text-2xl font-bold text-blue-600" data-id="today-orders">0</p>
          </div>
          <div class="bg-blue-100 p-3 rounded-full">
            <i data-lucide="calendar" class="w-6 h-6 text-blue-600"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white rounded-lg p-6 shadow-sm mb-8" data-id="quick-actions">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h2>
      <div class="flex flex-wrap gap-3">
        <button id="refresh-orders" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors flex items-center gap-2" data-id="refresh-btn">
          <i data-lucide="refresh-cw" class="w-4 h-4"></i>
          Refresh Orders
        </button>
        <button id="export-email" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2" data-id="export-email-btn">
          <i data-lucide="mail" class="w-4 h-4"></i>
          Get Email Content
        </button>
        <button id="send-whatsapp" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2" data-id="whatsapp-btn">
          <i data-lucide="message-circle" class="w-4 h-4"></i>
          Send WhatsApp
        </button>
        <button id="clear-orders" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2" data-id="clear-btn">
          <i data-lucide="trash-2" class="w-4 h-4"></i>
          Clear All Orders
        </button>
      </div>
    </div>

    <!-- Orders Table -->
    <div class="bg-white rounded-lg shadow-sm overflow-hidden" data-id="orders-table-container">
      <div class="px-6 py-4 border-b">
        <h2 class="text-lg font-semibold text-gray-800" data-id="orders-table-title">Recent Orders</h2>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full" data-id="orders-table">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Size</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody id="orders-tbody" class="bg-white divide-y divide-gray-200" data-id="orders-tbody">
            <tr data-id="no-orders-row">
              <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                <p>No orders yet. Orders will appear here when customers place them.</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Order Details Modal -->
  <div id="order-details-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4" data-id="order-details-modal">
    <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" data-id="modal-content">
      <div class="p-6 border-b flex justify-between items-center">
        <h3 class="text-xl font-bold text-gray-800" data-id="modal-title">Order Details</h3>
        <button id="close-details-modal" class="text-gray-400 hover:text-gray-600">
          <i data-lucide="x" class="w-6 h-6"></i>
        </button>
      </div>
      <div id="order-details-content" class="p-6" data-id="order-details-content">
        <!-- Order details will be populated here -->
      </div>
    </div>
  </div>

  <script type="module">
    // Initialize icons
    lucide.createIcons();

    // Load and display orders
    function loadOrders() {
      const orders = JSON.parse(localStorage.getItem('threadcraft_orders') || '[]');
      const tbody = document.getElementById('orders-tbody');
      
      // Update stats
      updateStats(orders);
      
      if (orders.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" class="px-6 py-8 text-center text-gray-500">
              <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
              <p>No orders yet. Orders will appear here when customers place them.</p>
            </td>
          </tr>
        `;
        lucide.createIcons();
        return;
      }
      
      tbody.innerHTML = orders.reverse().map(order => `
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-gray-900">#${order.id}</div>
            <div class="text-sm text-gray-500">${order.image?.name || 'Image uploaded'}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-gray-900">${order.name}</div>
            <div class="text-sm text-gray-500">${order.phone}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize">${order.size}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">$${order.price}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${order.timestamp}</td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 py-1 text-xs font-medium rounded-full bg-amber-100 text-amber-800">
              ${order.status || 'Pending'}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button onclick="viewOrderDetails(${order.id})" class="text-orange-600 hover:text-orange-900 mr-3">View</button>
            <button onclick="deleteOrder(${order.id})" class="text-red-600 hover:text-red-900">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function updateStats(orders) {
      const today = new Date().toDateString();
      const todayOrders = orders.filter(order => new Date(order.timestamp).toDateString() === today);
      const totalRevenue = orders.reduce((sum, order) => sum + order.price, 0);
      
      document.querySelector('[data-id="total-orders"]').textContent = orders.length;
      document.querySelector('[data-id="pending-orders"]').textContent = orders.filter(order => order.status === 'pending' || !order.status).length;
      document.querySelector('[data-id="total-revenue"]').textContent = `$${totalRevenue}`;
      document.querySelector('[data-id="today-orders"]').textContent = todayOrders.length;
    }

    // View order details
    window.viewOrderDetails = function(orderId) {
      const orders = JSON.parse(localStorage.getItem('threadcraft_orders') || '[]');
      const order = orders.find(o => o.id === orderId);
      if (!order) return;

      const modal = document.getElementById('order-details-modal');
      const content = document.getElementById('order-details-content');
      
      content.innerHTML = `
        <div class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">Order ID</label>
              <p class="mt-1 text-sm text-gray-900">#${order.id}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Date</label>
              <p class="mt-1 text-sm text-gray-900">${order.timestamp}</p>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">Customer Name</label>
            <p class="mt-1 text-sm text-gray-900">${order.name}</p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">Phone Number</label>
            <p class="mt-1 text-sm text-gray-900">${order.phone}</p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">Delivery Address</label>
            <p class="mt-1 text-sm text-gray-900">${order.address}</p>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">Size</label>
              <p class="mt-1 text-sm text-gray-900 capitalize">${order.size}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Price</label>
              <p class="mt-1 text-sm font-medium text-green-600">$${order.price}</p>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">Image File</label>
            <p class="mt-1 text-sm text-gray-900">${order.image?.name || 'Image uploaded'}</p>
          </div>
          
          ${order.notes ? `
            <div>
              <label class="block text-sm font-medium text-gray-700">Special Instructions</label>
              <p class="mt-1 text-sm text-gray-900">${order.notes}</p>
            </div>
          ` : ''}
          
          <div class="flex gap-3 pt-4 border-t">
            <button onclick="contactCustomer('${order.phone}', '${order.name}')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
              <i data-lucide="phone" class="w-4 h-4"></i>
              Call Customer
            </button>
            <button onclick="sendOrderWhatsApp(${order.id})" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
              <i data-lucide="message-circle" class="w-4 h-4"></i>
              WhatsApp
            </button>
          </div>
        </div>
      `;
      
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      lucide.createIcons();
    };

    // Delete order
    window.deleteOrder = function(orderId) {
      if (!confirm('Are you sure you want to delete this order?')) return;
      
      const orders = JSON.parse(localStorage.getItem('threadcraft_orders') || '[]');
      const updatedOrders = orders.filter(order => order.id !== orderId);
      localStorage.setItem('threadcraft_orders', JSON.stringify(updatedOrders));
      loadOrders();
    };

    // Contact customer
    window.contactCustomer = function(phone, name) {
      window.open(`tel:${phone}`, '_self');
    };

    // Send order WhatsApp
    window.sendOrderWhatsApp = function(orderId) {
      const orders = JSON.parse(localStorage.getItem('threadcraft_orders') || '[]');
      const order = orders.find(o => o.id === orderId);
      if (!order) return;

      const message = `Hi ${order.name}! üëã\n\nThank you for your string art order #${order.id}!\n\nüé® *Order Details:*\n- Size: ${order.size}\n- Price: $${order.price}\n- Image: ${order.image?.name}\n\nWe've received your order and will start working on it soon. We'll keep you updated on the progress!\n\nBest regards,\nThreadCraft Studio`;
      const whatsappUrl = `https://wa.me/${order.phone.replace(/[^0-9]/g, '')}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    };

    // Event listeners
    document.getElementById('refresh-orders').addEventListener('click', loadOrders);

    document.getElementById('export-email').addEventListener('click', () => {
      const emailContent = localStorage.getItem('latest_order_email');
      if (emailContent) {
        navigator.clipboard.writeText(emailContent).then(() => {
          alert('Latest order email content copied to clipboard!');
        });
      } else {
        alert('No recent orders found.');
      }
    });

    document.getElementById('send-whatsapp').addEventListener('click', () => {
      const whatsappUrl = localStorage.getItem('latest_order_whatsapp');
      if (whatsappUrl) {
        window.open(whatsappUrl, '_blank');
      } else {
        alert('No recent orders found.');
      }
    });

    document.getElementById('clear-orders').addEventListener('click', () => {
      if (confirm('Are you sure you want to clear all orders? This action cannot be undone.')) {
        localStorage.removeItem('threadcraft_orders');
        localStorage.removeItem('latest_order_email');
        localStorage.removeItem('latest_order_whatsapp');
        loadOrders();
        alert('All orders cleared.');
      }
    });

    // Close modal
    document.getElementById('close-details-modal').addEventListener('click', () => {
      document.getElementById('order-details-modal').classList.add('hidden');
      document.getElementById('order-details-modal').classList.remove('flex');
    });

    // Initialize
    loadOrders();

    // Auto-refresh every 30 seconds
    setInterval(loadOrders, 30000);
  </script>
</body>
</html>